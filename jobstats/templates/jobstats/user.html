{% extends 'base.html' %}
{% load humanize %}
{% load i18n %}
{% load bootstrap_pagination %}

{% block title %}
{% translate "Your jobs" %}
{% endblock title %}

{% block content %}
<h1>{% translate "Your current use" %}</h1>

<table class="table table-striped">
  <thead class="thead-dark">
    <tr>
      <th scope="col">{% translate "Type" %}</th>
      <th scope="col">{% translate "Allocated" %}</th>
      <th scope="col">{% translate "Used" %}</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>{% translate "CPU cores" %}</td>
      <td>{{total_cores}}</td>
      <td>{{cpu_used | floatformat:-2}}</td>
    </tr>
    <tr>
      <td>{% translate "Memory" %}</td>
      <td>{{total_mem | filesizeformat}}</td>
      <td>{{mem_used | filesizeformat}}</td>
    </tr>
    <tr>
      <td>{% translate "GPUs" %}</td>
      <td>{{total_gpus}}</td>
      <td>{{gpu_used | floatformat:-2}}</td>
    </tr>
  </tbody>
</table>

<h2>{% translate "CPU cores" %}</h2>
<div id="graph_cpu"></div>
<h2>{% translate "Memory" %}</h2>
<div id="graph_mem"></div>

<h2>{% translate "Filesystem" %}</h2>
<div id="graph_lustre_mdt"></div>
<div id="graph_lustre_ost"></div>

{% if gpu_used > 0 %}
<h2>{% translate "GPUs" %}</h2>
<div id="graph_gpu_utilization"></div>
<div id="graph_gpu_power"></div>
{% endif %}

<h1>{% translate "Your jobs" %}</h1>

<table class="table table-striped">
  <thead class="thead-dark">
    <tr>
      <th scope="col">{% translate "Job ID" %}</th>
      <th scope="col">{% translate "Status" %}</th>
      <th scope="col">{% translate "Job name" %}</th>
      <th scope="col">{% translate "Submit time" %}</th>
      <th scope="col">{% translate "Start time" %}</th>
      <th scope="col">{% translate "End time" %}</th>
      <th scope="col">{% translate "Asked time" %}</th>
      <th scope="col">{% translate "Used time" %}</th>
    </tr>
  </thead>
  <tbody>
{% for job in jobs %}
    <tr>
      <th scope="row"><a href="/secure/jobstats/{{username}}/{{job.id_job}}">{{job.id_job}}</a></th>
      <td><span class="badge badge-{{job.status_badge}}">{{job.status}}</span></td>
      <td>{{job.job_name}}</td>
      <td><span data-toggle="tooltip" data-placement="top" title="{{job.time_submit_dt}}">{{job.time_submit_dt | naturaltime}}</span></td>
      <td><span data-toggle="tooltip" data-placement="top" title="{{job.time_start_dt}}">{{job.time_start_dt | default_if_none:'' | naturaltime}}</span></td>
      <td><span data-toggle="tooltip" data-placement="top" title="{{job.time_end_dt}}">{{job.time_end_dt | default_if_none:'' | naturaltime}}</span></td>
      <td>{{job.timelimit_display | default_if_none:'' }}</td>
      <td>{{job.used_time_display | default_if_none:'' }}</td>
    </tr>
{% endfor %}
  </tbody>
</table>

{% bootstrap_paginate jobs range=10 extra_pagination_classes="justify-content-center" %}

<script>
loadGraph('graph_cpu', 'graph/cpu.json');
loadGraph('graph_mem', 'graph/mem.json');
loadGraph('graph_lustre_mdt', 'graph/lustre_mdt.json');
loadGraph('graph_lustre_ost', 'graph/lustre_ost.json');
{% if gpu_used > 0 %}
loadGraph('graph_gpu_utilization', 'graph/gpu_utilization.json');
loadGraph('graph_gpu_power', 'graph/gpu_power.json');
{% endif %}

</script>

{% endblock content %}
